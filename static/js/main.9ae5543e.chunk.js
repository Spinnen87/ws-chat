(window["webpackJsonpws-chat"]=window["webpackJsonpws-chat"]||[]).push([[0],{10:function(e,t,a){e.exports=a(17)},15:function(e,t,a){},17:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),c=a(7),i=a.n(c),o=(a(15),a(1)),r=a(2),l=a(4),u=a(3),m=a(5),h=a(8);var g=function(e){var t=e.status,a=e.userName,n=e.handleLogOut;return s.a.createElement("div",{className:"user"},s.a.createElement("div",{className:t?"user__avatar connect":"user__avatar disconnect"},a.slice(0,1)),s.a.createElement("div",{className:"user-info"},s.a.createElement("div",{className:"user-info__name"},a),s.a.createElement("div",{className:"user-info__connect-status"},t?"connect":"disconnect")),s.a.createElement("div",null,s.a.createElement("button",{type:"button",className:"btn-sing-out fas fa-sign-out-alt",onClick:n})))},p=a(9),d=a.n(p);var f=function(e){var t=e.from,a=e.message,n=e.time,c=e.user,i="".concat(new d.a(n).calendar());return s.a.createElement("div",{className:c===t?"message message_rigth":"message"},s.a.createElement("div",null,c===t?s.a.createElement("p",{className:"message__date"},i,s.a.createElement("span",{className:"message__avtor"}," ",t)):s.a.createElement("p",{className:"message__avtor"},t,s.a.createElement("span",{className:"message__date"}," ",i))),s.a.createElement("div",{className:"message__body"},a))},v=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).divChatMessages=s.a.createRef(),a}return Object(m.a)(t,e),Object(r.a)(t,[{key:"componentDidUpdate",value:function(){this.divChatMessages.current.scrollTop=this.divChatMessages.current.scrollHeight}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"chat"},s.a.createElement("div",{className:"chat-messages",ref:this.divChatMessages},this.props.messages.map(function(t){return s.a.createElement(f,{key:t.id,from:t.from,message:t.message,time:t.time,user:e.props.user})})))}}]),t}(n.Component),N=function(e){function t(){var e,a;Object(o.a)(this,t);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={inputValue:""},a.textInputChange=function(e){a.setState({inputValue:e.target.value})},a}return Object(m.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"send-message"},s.a.createElement("form",{className:"send-message__form"},s.a.createElement("input",{className:"send-message__input",type:"text",value:this.state.inputValue,placeholder:"Type you message",onChange:this.textInputChange}),s.a.createElement("input",{className:"send-message__submit",type:"submit",value:"send",onClick:function(t){t.preventDefault(),e.setState({inputValue:""}),e.props.handleClick(e.state.inputValue)}})))}}]),t}(n.Component),b=function(e){function t(){var e,a;Object(o.a)(this,t);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={inputValue:""},a.changeInput=function(e){a.setState({inputValue:e.target.value})},a}return Object(m.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"login"},s.a.createElement("h1",null,"Welcome to RS School Chat"),s.a.createElement("form",{className:"login__form"},s.a.createElement("input",{className:"login__input",type:"text",value:this.state.inputValue,placeholder:"Enter you name",onChange:this.changeInput}),s.a.createElement("input",{className:"btn-sing-in",type:"submit",value:"Sing in",onClick:function(t){t.preventDefault(),e.setState({inputValue:""}),e.props.handleSingIn(e.state.inputValue)}})))}}]),t}(n.Component),E=function e(){if("granted"===Notification.permission){var t=new Notification("New message",{tag:"message"});setTimeout(t.close.bind(t),4e3),e.onclick=function(){return window.open("/ws-chat")}}else"denied"!==Notification.permission&&Notification.requestPermission()},w=function(e){function t(){var e,a;Object(o.a)(this,t);for(var n=arguments.length,s=new Array(n),c=0;c<n;c++)s[c]=arguments[c];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={userName:"",status:!1,messages:[],notifications:!1},a.ws=new h.a("wss://wssproxy.herokuapp.com/",[],{connectionTimeout:3e3}),a.handleSingIn=function(e){a.setState({userName:e}),""!==e&&localStorage.setItem("userName",JSON.stringify(e))},a.handleLogOut=function(){a.setState({userName:""}),localStorage.clear()},a.handleClick=function(e){a.ws.send(JSON.stringify({from:a.state.userName,message:e}))},a}return Object(m.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({userName:JSON.parse(localStorage.getItem("userName"))}),this.ws.onopen=function(t){e.setState({status:!0}),console.log("WebSocket: Connection established")},this.ws.onmessage=function(t){e.state.notifications&&E(),e.setState({messages:e.state.messages.concat(JSON.parse(t.data).reverse())})},this.ws.onclose=function(t){t.wasClean?console.log("WebSocket: Connection closed cleanly"):console.log("WebSocket: Connection break"),console.log("WebSocket: Code: "+t.code+" cause: "+t.reason),e.setState({status:!1})},this.ws.onerror=function(e){console.log("WebSocket: Error "+e.message)},window.onfocus=function(){e.setState({notifications:!1})},window.onblur=function(){e.setState({notifications:!0})}}},{key:"render",value:function(){return this.state.userName?s.a.createElement("div",{className:"App"},s.a.createElement(g,{status:this.state.status,userName:this.state.userName,handleLogOut:this.handleLogOut}),s.a.createElement(v,{messages:this.state.messages,user:this.state.userName}),s.a.createElement(N,{handleClick:this.handleClick})):s.a.createElement(b,{handleSingIn:this.handleSingIn})}}]),t}(n.Component);i.a.render(s.a.createElement(w,null),document.getElementById("root"))}},[[10,1,2]]]);
//# sourceMappingURL=main.9ae5543e.chunk.js.map